# GitHub Reports

Generates various reports related to daily pull request and commit creation.

## Setup & Usage

1. Install Ruby: https://www.ruby-lang.org/en/documentation/installation/
1. Clone the repository: `git clone git@github.com:nicholasdower/git-reports.git`
1. `cd git-reports`
1. Create a config file (See Configuration): `cp example.config.json foo.config.json`
1. Create a GitHub Personal Access Token and add it to the config file: https://docs.github.com/en/authentication/keeping-your-account-and-data-secure/creating-a-personal-access-token
1. Generate reports: `CONFIG=foo.config.json make generate`
1. View reports: `open reoprts/foo/github-reports.html`
1. View report data: `cat reoprts/foo/prs_per_day.tsv`

## Configuration

Various options are controlled via a JSON file. To start, copy `example.config.json` to a file like `foo.config.json` in the root of the project. Reports will be written to a subdirectory of the `reports` directory.

```
{
  # The name of the config. This will be used as the name of the directories containing the data and generated reports.
  "name": "foo",

  # GitHub personal access token.
  "github_token": "token",

  # The first day for which data will be considered. Defaults to 2022-01-01.
  "start_day": "2022-01-01",

  # The last day for which data will be considered. Defaults to yesterday.
  "end_day": "2022-08-01",

  # Regex applied to PR titles and commit messages to determine whether they were automatically generated and should be ignored. Defaults to null.
  "auto_regex": "AUTO",

  # Search string to use when querying GitHub for PRs. Required, no default.
  "prs_github_search": "org:github",

  # Search string to use when querying GitHub for commits. Required, no default.
  "commits_github_search": "org:github",

  # Number of seconds to wait between API requests. Defaults to 11 seconds.
  "rate_limit": 11,

  # Whether to include user-specific data in reports. Defaults to false.
  "user_breakdown": false,

  # Mapping of group name to list of GitHub usernames. Weekly and monthly PR reports will be generated for each group. Defaults to {}.
  "user_groups": {
    "group1": [
      "user1",
      "user2",
      ...
    ],
    "group2": [
      "user3",
      "user4",
      ...
    ],
    ...
  },

  # List of GitHub usernames used by bots. All PRs and commits from bots will be ignored. Defaults to [].
  "bots": [
    "user5",
    "user6",
    ...
  ]
}
```

## Reports

Reports are generated by `Report` classes found in `lib/reports`. The output can be found in the `reports` directory at the root of the project.

Reports are generated from daily pull request and commit data downloaded using the GitHub Issues & Pull Requests API and the GitHub Commits API:

- https://docs.github.com/en/rest/search#search-issues-and-pull-requests.
- https://docs.github.com/en/rest/search#search-commits

Data is stored in the `data` directory and reused between runs. New data is only downloaded for missing days.

### Default Reports

- prs_per_day.tsv
- prs_per_week.tsv
- prs_per_month.tsv
- commits_per_day.tsv
- commits_per_week.tsv
- commits_per_month.tsv
- top_users_last_week.tsv
- top_users_last_month.tsv
- top_users_last_year.tsv

### User Group Reports

It is also possible to generate reports for groups of users with or without data about specific users. See the Configuration section above.

### Custom reports

To add a report locally which you do not wish to commit to this repo, put the report in `lib/reports/custom`. See `lib/reports/custom/example.rb` for an example.
